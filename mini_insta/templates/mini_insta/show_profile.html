<!-- File: mini_insta/templates/mini_insta/show_all_profiles.html-->
<!-- Author: Louise Lee, llouise@bu.edu, 09/25/2025 -->
<!-- Description: Displays a single Profile in detail with placeholders for future features -->

{% extends 'mini_insta/base.html' %}

<!-- Layout of an individual profile view -->
{% block content %}
<h1>MiniInsta: @{{profile.username}}</h1>

<main class="profile-container">
  <section class="profile">
    <div class="avatar-ring">
      <div class="avatar">
        <img src="{{ profile.profile_image_url }}" alt="Profile image">
      </div>
    </div>

    <div class="profile-fields">
      <h2 class="display-name">{{ profile.display_name|default:profile.username }}</h2>

      <div class="stats">
        <div>
          <strong>{{ profile.get_num_posts }}</strong>
          <small>posts</small>
        </div>
        <div>
          <a href="{% url 'show_followers' profile.pk %}">
            <strong>{{ profile.get_num_followers }}</strong>
            <small>followers</small>
          </a>
        </div>
        <div>
          <a href="{% url 'show_following' profile.pk %}">
            <strong>{{ profile.get_num_following }}</strong>
            <small>following</small>
          </a>
        </div>
      </div>

      <!-- Follow/Unfollow buttons (only show if logged in and viewing another user's profile) -->
      {% if request.user.is_authenticated and user_profile and user_profile != profile %}
        <div class="follow-actions">
          {% if is_following %}
            <form method="POST" action="{% url 'unfollow_profile' profile.pk %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn unfollow-btn">Unfollow</button>
            </form>
          {% else %}
            <form method="POST" action="{% url 'follow_profile' profile.pk %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn follow-btn">Follow</button>
            </form>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </section>

  <!-- BIO -->
  <ul class="bio">
    <li>Bio: {{ profile.bio_text }}</li>
    <li>Joined: {{profile.join_date}}</li>
    
    <!-- Only show Update Profile link if this is the logged-in user's profile -->
    {% if request.user.is_authenticated and profile.user == request.user %}
      <a href="{% url 'update_profile' %}" class="btn">Update Profile</a>
    {% endif %}
  </ul>

  <!-- POSTS -->
  <ul class="posts-grid">
    {% for post in profile.get_all_posts %}
      <li class="post-card">
        <a href="{% url 'show_post' post.pk %}">
          {% for photo in post.get_all_photos|slice:":1" %}
            {% with url=photo.get_image_url %}
              {% if url %}
                <img src="{{ url }}" alt="Post image">
              {% else %}
                <div class="no-image">No image</div>
              {% endif %}
            {% endwith %}
          {% empty %}
            <div class="no-image">No image</div>
          {% endfor %}
        </a>
      </li>
    {% endfor %}
  </ul>
  
</main>
{% endblock %}